# CI Guidelines

이 문서는 SuperFlag 저장소에서 CI 파이프라인을 설계하거나 수정할 때 따라야 할 기준을 모았습니다.

## 기본 원칙
- **비대화식 실행**: 워크플로에서 호출하는 모든 명령은 사용자 입력 없이 완료되어야 합니다. 필요한 인자는 명시적으로 넘깁니다.
- **명시적 타깃 지정**: `superflag install`/`superflag uninstall` 시 항상 `--target` 플래그를 지정합니다 (예: `superflag uninstall --target cn`).
- **환경 독립성 유지**: PATH 차이를 줄이기 위해 가급적 `python -m superflag` 같은 모듈 실행 방식과 가상환경 내 파이썬을 사용합니다.
- **빠른 실패 탐지**: 휠 빌드 → 설치 → 핵심 서브커맨드 실행과 같은 최소 스모크 테스트를 통해 배포 전 기본 동작 여부를 확인합니다.
- **상태 정리**: 테스트 후 생성된 설정·캐시·설치 흔적을 정리합니다 (`superflag uninstall --target ...`, `pipx uninstall superflag` 등).

## 테스트 확장 시 체크포인트
- 새 플랫폼이나 타깃 검증을 추가할 때도 "설치 → 검증 → 비대화식 제거" 패턴을 따릅니다.
- CLI에 대화형 기능이 늘어난다면 `--non-interactive`, `--yes` 등 우회 옵션을 제공하고 CI에서는 그 옵션을 사용합니다.
- 외부 서비스 의존 테스트는 mock/sandbox 또는 opt-in 형태로 구성합니다.
- 복잡한 통합 테스트는 별도 job/step으로 분리해 실패 원인을 빠르게 파악할 수 있게 합니다.

## 워크플로 수정 체크리스트
- [ ] 새 스텝이 사용자 입력을 요구하지 않는가?
- [ ] 플랫폼/파이썬 버전 매트릭스가 최신 요구사항을 반영하는가?
- [ ] 빌드 산출물(휠·SDist)이 생성되고 검증되는가?
- [ ] 테스트 후 정리가 완전하게 이뤄지는가?
- [ ] 실패 시 유용한 로그와 종료 코드를 남기는가?

이 원칙을 지키면 CLI가 확장되거나 테스트가 추가되어도 CI가 안정적으로 동작하고, 장애 발생 시 빠른 원인 파악이 가능합니다.
